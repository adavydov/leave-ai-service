<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Leave AI</title>
  <link rel="stylesheet" href="/static/styles.css?v=5" />
</head>
<body>
  <header class="topbar" role="banner">
    <div class="brand">Leave AI <span>Быстрая проверка заявления на отпуск</span></div>
    <div class="top-actions">
      <button id="historyToggle" type="button">История</button>
      <button id="helpToggle" type="button">Помощь</button>
      <button id="themeToggle" type="button" aria-label="Переключить тему">Тема</button>
    </div>
  </header>

  <main class="layout-simple">
    <section class="card">
      <h2>1) Загрузите файл</h2>
      <div id="dropzone" class="dropzone" tabindex="0" aria-label="Зона перетаскивания PDF">
        <p><strong>Перетащите PDF</strong> или выберите файл</p>
        <p class="muted">PDF до 15MB</p>
        <input id="fileInput" type="file" accept="application/pdf" />
        <div class="row">
          <button id="processBtn" class="primary" type="button">Проверить файл</button>
          <button id="cancelBtn" type="button" class="hidden">Отменить</button>
        </div>
      </div>
      <p id="fileHint" class="muted"></p>
    </section>

    <section class="card" id="decisionBanner">
      <h2 id="decisionTitle">2) Статус проверки</h2>
      <p id="decisionReason" class="muted">Загрузите PDF, чтобы начать проверку.</p>
      <p id="headerBadge" class="badge">Статус: ожидание</p>
    </section>

    <section class="card">
      <h2>3) Ошибки в файле</h2>
      <p id="issuesSummary" class="muted">Критичных: 0 • Некритичных: 0</p>
      <div id="issuesExplorer"></div>
    </section>

    <section class="card" id="quickDownload">
      <h2>4) Скачайте результат</h2>
      <p class="muted">Файлы доступны сразу после проверки.</p>
      <div class="row">
        <button id="quickDownloadTextBtn" class="primary" type="button" disabled>Скачать исправленный текст (.txt)</button>
        <button id="quickDownloadJsonBtn" type="button" disabled>Скачать отчет (.json)</button>
      </div>
    </section>

    <details class="card">
      <summary><strong>Расширенные инструменты</strong></summary>
      <div class="row"><label><input id="editToggle" type="checkbox" /> Редактировать поля вручную</label></div>
      <div id="extractFormWrap" class="hidden"></div>
      <table class="table" id="resultTable"><tbody></tbody></table>
      <pre id="rewriteText" class="pre"></pre>
      <details id="rawSection" class="hidden"><summary>Распознанный текст</summary><pre id="rawText" class="pre"></pre></details>
      <p class="muted">request_id: <span id="requestId">—</span></p>
      <p class="muted">timings: <span id="timings">—</span></p>
      <div class="row">
        <button id="copyTextBtn" type="button">Скопировать текст</button>
        <button id="downloadTextBtn" type="button">Скачать .txt</button>
        <button id="copyJsonBtn" type="button">Copy JSON</button>
        <button id="downloadJsonBtn" type="button">Download JSON</button>
        <button id="downloadCsvBtn" type="button">Download CSV</button>
        <button id="printBtn" type="button">Печать</button>
        <button id="copyDiagBtn" type="button">Copy diagnostic report</button>
      </div>
    </details>

    <section id="errorCard" class="card hidden">
      <h3 id="errorTitle">Ошибка</h3>
      <p id="errorMessage"></p>
      <pre id="errorDetails" class="pre"></pre>
      <button id="retryBtn" type="button">Повторить</button>
    </section>

    <details class="card">
      <summary><strong>Диагностика</strong></summary>
      <div class="progress" id="progress" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0"><div id="progressBar"></div></div>
      <ul id="logs"></ul>
    </details>
  </main>

  <aside id="historyDrawer" class="drawer hidden">
    <div class="row"><strong>История</strong><button id="clearHistoryBtn" type="button">Очистить</button></div>
    <div id="historyList"></div>
  </aside>

  <dialog id="helpDialog">
    <h3>Как пользоваться</h3>
    <ol>
      <li>Загрузите PDF и нажмите «Проверить файл».</li>
      <li>Смотрите понятный статус проверки.</li>
      <li>Исправьте ошибки по подсказкам из списка.</li>
      <li>Сразу скачайте результат.</li>
    </ol>
    <button id="closeHelpBtn" type="button">Закрыть</button>
  </dialog>

  <div id="toast" class="toast hidden" role="status" aria-live="polite"></div>
  <script type="module" src="/static/app.js?v=5"></script>
</body>
</html>
